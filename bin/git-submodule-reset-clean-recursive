#!/usr/bin/env bash
set -euo pipefail

# Hard reset and clean all submodules recursively (destructive).
# Manual equivalent:
#   git submodule foreach --recursive "git reset --hard && git clean -fdx"
usage() {
  cat <<'EOF'
Usage: git-submodule-reset-clean-recursive

Hard reset and clean all submodules (destructive).

Options:
  -h, --help, -help  Show help
EOF
}

# Show help and exit early when requested.
if [[ "${1:-}" == "-h" || "${1:-}" == "--help" || "${1:-}" == "-help" ]]; then
  usage
  exit 0
fi

# This command takes no arguments, so error on extras.
if [[ $# -gt 0 ]]; then
  echo "Unexpected arguments: $*" >&2
  usage >&2
  exit 1
fi

# Execute the git command.
git submodule foreach --recursive "git reset --hard && git clean -fdx"
